services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - Firestore__ProjectId=${GCP_PROJECT_ID}
      - PubSub__ProjectId=${GCP_PROJECT_ID}
      - PubSub__InventoryTopicId=inventory-low
      - PubSub__DemandTopicId=high-demand
    volumes:
      - ~/.config/gcloud:/root/.config/gcloud:ro

  worker:
    build:
      context: .
      dockerfile: Dockerfile.worker
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - Firestore__ProjectId=${GCP_PROJECT_ID}
      - PubSub__ProjectId=${GCP_PROJECT_ID}
      - PubSub__InventorySubscriptionId=inventory-low-sub
      - PubSub__DemandSubscriptionId=high-demand-sub
    depends_on:
      - api
    volumes:
      - ~/.config/gcloud:/root/.config/gcloud:ro
